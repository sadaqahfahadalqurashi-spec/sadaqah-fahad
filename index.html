<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ุตุฏูุฉ ุฌุงุฑูุฉ | ุงููุฑุญูู ููุฏ ุงููุฑุดู</title>
  <meta name="description" content="ุตุฏูุฉ ุฌุงุฑูุฉ ุนู ุงููุฑุญูู ููุฏ ุงููุฑุดู โ ุฃุฐูุงุฑ ูุชุดุบูู ุงููุฑุขู ุงููุฑูู ุจุตูุช ุงูุดูุฎ ุงูุณุฏูุณ" />
  <meta name="theme-color" content="#0b2a1a" />
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./assets/icon.svg" type="image/svg+xml">
  <style>
    :root{
      --bg:#06160f;
      --bg2:#081f14;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --border:rgba(255,255,255,.14);
      --text:#ecfdf5;
      --muted:rgba(236,253,245,.72);
      --gold:#f4d06f;
      --green:#34d399;
      --blue:#60a5fa;
      --danger:#fb7185;
      --shadow: 0 20px 55px rgba(0,0,0,.40);
      --radius:18px;
      --radius2:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 80% -10%, rgba(244,208,111,.16), transparent 60%),
        radial-gradient(900px 600px at 10% 10%, rgba(52,211,153,.14), transparent 55%),
        radial-gradient(900px 650px at 70% 120%, rgba(96,165,250,.10), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      line-height:1.9;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      overflow-x:hidden;
    }
    a{color:var(--blue); text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1100px; margin:0 auto; padding:18px 16px 42px}
    header{padding:22px 0 10px}
    .hero{
      position:relative;
      border:1px solid var(--border);
      border-radius: calc(var(--radius) + 6px);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 350px at 20% 0%, rgba(52,211,153,.22), transparent 60%),
        radial-gradient(600px 320px at 85% 10%, rgba(244,208,111,.18), transparent 55%);
      opacity:.75;
      pointer-events:none;
    }
    .motif{
      position:absolute; inset:0;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(244,208,111,.10) 0 2px, transparent 3px),
        radial-gradient(circle at 80% 30%, rgba(52,211,153,.09) 0 2px, transparent 3px),
        radial-gradient(circle at 35% 75%, rgba(96,165,250,.08) 0 2px, transparent 3px);
      background-size: 90px 90px;
      opacity:.55;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .hero-inner{
      position:relative;
      padding:18px 16px 18px;
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background: rgba(0,0,0,.18);
      color:var(--muted);
      font-size:13px;
      width:fit-content;
    }
    .b-dot{
      width:10px;height:10px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, var(--green), rgba(52,211,153,.35));
      box-shadow: 0 0 0 4px rgba(52,211,153,.10);
    }
    h1{
      margin:10px 0 4px;
      font-size: clamp(22px, 3.2vw, 30px);
      letter-spacing:.2px;
    }
    .calligraphy{
      font-family: "Scheherazade New", "Amiri", "Noto Naskh Arabic", serif;
      font-size: clamp(18px, 2.7vw, 26px);
      color: rgba(244,208,111,.95);
      margin:0;
    }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      font-size:14px;
      max-width: 62ch;
    }
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      margin-top:6px;
    }
    button, select, input{
      font:inherit;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:10px 12px;
      outline:none;
    }
    button{cursor:pointer}
    button:active{transform: translateY(1px)}
    .primary{border-color: rgba(52,211,153,.55); background: rgba(52,211,153,.12)}
    .secondary{border-color: rgba(96,165,250,.55); background: rgba(96,165,250,.12)}
    .gold{border-color: rgba(244,208,111,.60); background: rgba(244,208,111,.12); color: var(--text)}
    .danger{border-color: rgba(251,113,133,.60); background: rgba(251,113,133,.12)}
    .ghost{background: rgba(0,0,0,.18)}
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .actions{justify-content:flex-start}
    }
    .card{
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:18px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .divider{height:1px;background: var(--border); margin:12px 0}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:12px;
      width:fit-content;
      max-width:100%;
    }
    .pill b{color: var(--text); font-weight:600}
    .dua{
      border:1px solid var(--border);
      border-radius: var(--radius2);
      background: rgba(0,0,0,.18);
      padding:12px;
      text-align:right;
    }
    .dua .k{color: rgba(244,208,111,.92); font-weight:600; font-size:13px}
    .dhikr{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:start;
      padding:12px;
      border:1px solid var(--border);
      border-radius: var(--radius2);
      background: rgba(255,255,255,.03);
      margin:10px 0;
      text-align:right;
    }
    .dhikr .t{font-size:15px}
    audio{width:100%; margin-top:10px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .two{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    @media(max-width:640px){ .two{grid-template-columns:1fr} }
    .counter{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px; border:1px solid var(--border); border-radius: var(--radius2);
      background: rgba(0,0,0,.18);
    }
    .counter .num{
      font-size:24px; font-weight:700; color: rgba(244,208,111,.95);
      letter-spacing: .4px;
    }
    .toast{
      position: fixed;
      left: 16px; right: 16px;
      bottom: 16px;
      margin: 0 auto;
      max-width: 560px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      display:none;
      z-index: 50;
      font-size: 13px;
      text-align:right;
    }
    .toast.show{display:block; animation: pop .22s ease-out}
    @keyframes pop{ from{transform: translateY(10px); opacity:0} to{transform: translateY(0); opacity:1} }
    footer{margin-top:16px; color: var(--muted); font-size:12px; text-align:center}
    .sep{opacity:.55; margin:0 8px}
    .kbd{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      border-radius: 10px;
      padding: 3px 7px;
      font-size:12px;
      color: var(--muted);
    }
    /* Autoplay overlay */
    .autoplay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding:16px;
      z-index:60;
      background: rgba(2,6,4,.72);
      backdrop-filter: blur(10px);
    }
    .autoplay.show{display:flex}
    .autoplay-card{
      max-width: 560px;
      width:100%;
      border:1px solid var(--border);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding: 18px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .autoplay-card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 280px at 20% 0%, rgba(52,211,153,.22), transparent 62%),
        radial-gradient(540px 260px at 90% 10%, rgba(244,208,111,.18), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .autoplay-card > *{position:relative}
    .autoplay-title{
      font-size: 18px;
      margin: 0 0 8px;
      color: var(--text);
      display:flex; align-items:center; justify-content:center; gap:10px;
    }
    .autoplay-note{color: var(--muted); font-size: 13px; margin:0 0 14px}
    .autoplay-actions{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .crescent{
      width:22px; height:22px; border-radius:999px;
      box-shadow: -6px 0 0 0 rgba(244,208,111,.95);
      background: transparent;
      filter: drop-shadow(0 0 10px rgba(244,208,111,.25));
    }
    /* Accessibility */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero" aria-label="ุตุฏูุฉ ุฌุงุฑูุฉ">
      <div class="motif" aria-hidden="true"></div>
      <div class="hero-inner">
        <div>
          <div class="badge"><span class="b-dot"></span>ุตุฏูุฉ ุฌุงุฑูุฉ</div>
          <p class="calligraphy">๏ทฝ</p>
          <h1>ุตุฏูุฉ ุฌุงุฑูุฉ ุนู ุงููุฑุญูู: <span id="name">ููุฏ ุงููุฑุดู</span> ๐ค</h1>
          <p class="sub">
            ุงูููู ุงุบูุฑ ูู ูุงุฑุญููุ ูุนุงูู ูุงุนู ุนููุ ูุฃูุฑู ูุฒูู ููุณุน ูุฏุฎููุ ูุงุฌุนู ูุจุฑู ุฑูุถุฉู ูู ุฑูุงุถ ุงูุฌูุฉ.
          </p>
          <p class="muted small" style="margin:10px 0 0">
            โ๏ธ ุชูุจูู: ุนูู ุจุนุถ ุฃุฌูุฒุฉ iPhone ูุฏ ูุง ูุณุชูุฑ ุงูุตูุช ุฅุฐุง ุฃูุบููุช ุงูุดุงุดุฉ ุฃู ุฎุฑุฌุช ูู ุงููุชุตูุญ (ุณูุงุณุฉ iOS). ุฏุงุฎู ุงูุตูุญุฉ ูุนูู ุจุซุจุงุช ุจุฅุฐู ุงููู.
          </p>
        </div>
        <div class="actions">
          <button class="gold" id="shareBtn" title="ูุดุงุฑูุฉ ุงูุตูุญุฉ">๐ ูุดุงุฑูุฉ</button>
          <button class="secondary" id="copyLinkBtn" title="ูุณุฎ ุฑุงุจุท ุงูุตูุญุฉ">๐ ูุณุฎ ุงูุฑุงุจุท</button>
          <button class="ghost" id="fullBtn" title="ุนุฑุถ ููุก ุงูุดุงุดุฉ">โถ ููุก ุงูุดุงุดุฉ</button>
        </div>
      </div>
    </header>

    <main class="grid">
      <!-- ุงููุฑุขู -->
      <section class="card" aria-label="ุงููุฑุขู ุงููุฑูู">
        <h2>๐ ุงููุฑุขู ุงููุฑูู <span class="pill"><b>ุงูุณุฏูุณ</b> โข ุชุดุบูู ูุชูุงุตู</span></h2>
        <p class="muted small">
          ูุญุงูู ุงูุชุดุบูู ุชููุงุฆููุง ุนูุฏ ูุชุญ ุงูุตูุญุฉ. ุฅู ููุน ุงููุชุตูุญ ุงูุตูุชุ ุณูุธูุฑ ุฒุฑ <span class="kbd">ุชุดุบูู ุงูุขู</span>.
        </p>

        <div class="controls">
          <label class="muted" for="playlistSelect">ุงููุงุฆูุฉ:</label>
          <select id="playlistSelect" aria-label="ุงุฎุชูุงุฑ ูุงุฆูุฉ ุงูุชุดุบูู"></select>
          <button class="primary" id="playBtn">โถ ุชุดุบูู</button>
          <button class="secondary" id="pauseBtn">โธ ุฅููุงู ูุคูุช</button>
          <button class="secondary" id="nextBtn">โญ ุงูุชุงูู</button>
          <button class="danger" id="stopBtn">โน ุฅููุงู</button>
        </div>

        <audio id="player" controls preload="auto" playsinline></audio>

        <div class="divider"></div>

        <div class="row">
          <span class="pill" id="nowPlaying">ุฌุงูุฒ ููุชุดุบูู</span>
          <span class="pill" id="trackCount">โ</span>
          <span class="pill" id="playTime">โฑ 00:00</span>
          <span class="pill" id="netState">๐ โ</span>
        </div>

        <div class="divider"></div>

        <div class="dua">
          <div class="k">ุชุญุณูู ุงูุงุณุชูุฑุงุฑ</div>
          <div class="muted small">
            ุงูุตูุญุฉ ุชุนูุฏ ุงููุญุงููุฉ ุชููุงุฆููุง ุนูุฏ ุงูุงููุทุงุนุ ูุชุญุงูู ุงูุงุณุชุฆูุงู ุนูุฏ ุงูุฑุฌูุน ููุตูุญุฉ.
            ููููููุง ููุน ุงูุทูุงุก ุงูุดุงุดุฉ ุนูู ุงูุฃุฌูุฒุฉ ุงูุฏุงุนูุฉ (Wake Lock) ุจุนุฏ ุฃูู ุชูุงุนู.
          </div>
        </div>
      </section>

      <!-- ุฃุฐูุงุฑ + ุชุณุจูุญ -->
      <aside class="card" aria-label="ุงูุฃุฐูุงุฑ">
        <h2>๐๏ธ ุฃุฐูุงุฑ ูุฏุนุงุก</h2>

        <div class="dua">
          <div class="k">ุฏุนุงุก ููููุช</div>
          <div>
            ุงูููู ุงุบูุฑ ูู <b>ููุฏ ุงููุฑุดู</b> ูุงุฑุญููุ ูุนุงูู ูุงุนู ุนููุ ููุณุน ูุฏุฎููุ
            ูููููู ูู ุงูุฎุทุงูุง ููุง ูููููู ุงูุซูุจ ุงูุฃุจูุถ ูู ุงูุฏูุณุ ูุจุฏูู ุฏุงุฑูุง ุฎูุฑูุง ูู ุฏุงุฑูุ
            ูุฃูููุง ุฎูุฑูุง ูู ุฃูููุ ูุฃุฏุฎูู ุงูุฌูุฉ ูุฃุนุฐู ูู ุนุฐุงุจ ุงููุจุฑ ููู ุนุฐุงุจ ุงููุงุฑ.
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button class="secondary" id="showMorning">๐ ุงูุตุจุงุญ</button>
          <button class="secondary" id="showEvening">๐ ุงููุณุงุก</button>
          <button class="secondary" id="showSleep">๐ด ุงูููู</button>
          <button class="ghost" id="randomDhikr">โจ ุฐูุฑ ุนุดูุงุฆู</button>
        </div>

        <div id="adhkarArea" aria-live="polite"></div>

        <div class="divider"></div>

        <h2>๐ข ุนุฏูุงุฏ ุชุณุจูุญ</h2>
        <div class="two">
          <button class="primary" id="tasbihBtn">ุณุจุญุงู ุงููู (+1)</button>
          <button class="secondary" id="tahmidBtn">ุงูุญูุฏ ููู (+1)</button>
          <button class="secondary" id="takbirBtn">ุงููู ุฃูุจุฑ (+1)</button>
          <button class="gold" id="tahlilBtn">ูุง ุฅูู ุฅูุง ุงููู (+1)</button>
        </div>

        <div style="height:10px"></div>

        <div class="counter">
          <div>
            <div class="muted small">ุงููุฌููุน</div>
            <div class="num" id="count">0</div>
          </div>
          <div class="row">
            <button class="ghost" id="undoBtn" title="ุชุฑุงุฌุน">โฉ๏ธ ุชุฑุงุฌุน</button>
            <button class="danger" id="resetBtn">ุชุตููุฑ</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="dua">
          <div class="k">ูุตูุญุฉ</div>
          <div class="muted small">
            ุงุฌุนู ููุชู: ุซูุงุจ ุงููุฑุงุกุฉ ูุงูุฐูุฑ ูุฏูุฉู ูููุฑุญููุ ูุน ุงูุฏุนุงุก ูู ุฏุงุฆููุง ๐ค
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <span>ุชู ุฅูุดุงุก ูุฐู ุงูุตูุญุฉ ููุฌู ุงููู ุชุนุงูู</span>
      <span class="sep">โข</span>
      <span class="muted">ููููู ุชุนุฏูู ุงูุงุณู ุฏุงุฎู ุงูููู ุจุณูููุฉ</span>
    </footer>
  </div>

  <!-- Autoplay overlay -->
  <div id="autoplay" class="autoplay" role="dialog" aria-modal="true" aria-label="ุชุดุบูู ุชููุงุฆู">
    <div class="autoplay-card">
      <div class="autoplay-title"><span class="crescent" aria-hidden="true"></span>ุชุดุบูู ุงููุฑุขู ุชููุงุฆููุง</div>
      <p class="autoplay-note">
        ุจุนุถ ุงููุชุตูุญุงุช ุชููุน ุชุดุบูู ุงูุตูุช ุชููุงุฆููุง. ุงุถุบุท ุฒุฑ <b>ุชุดุบูู ุงูุขู</b> ูุฑุฉ ูุงุญุฏุฉ ูุณูุณุชูุฑ ุงูุชุดุบูู ุชููุงุฆููุง ุจุนุฏ ุฐูู ุจุฅุฐู ุงููู.
      </p>
      <div class="autoplay-actions">
        <button class="primary" id="autoplayStart">โถ ุชุดุบูู ุงูุขู</button>
        <button class="ghost" id="autoplayClose">ุฅุบูุงู</button>
      </div>
      <div style="height:10px"></div>
      <div class="pill" style="margin:0 auto">ูุตูุญุฉ: ุงุชุฑู ุงูุตูุญุฉ ููุชูุญุฉ ูุชุณุชูุฑ ุงูุชูุงูุฉ</div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ===================== ุฅุนุฏุงุฏ ููุงุฆู ุชุดุบูู ุงููุฑุขู (ุงูุณุฏูุณ) ===================== */
const SUDAIS_BASE = "https://download.quranicaudio.com/quran/abdurrahmaan_as-sudays/";
function surahUrl(n){ return SUDAIS_BASE + String(n).padStart(3, "0") + ".mp3"; }

const juz30Names = {
  78:"ุงููุจุฃ",79:"ุงููุงุฒุนุงุช",80:"ุนุจุณ",81:"ุงูุชูููุฑ",82:"ุงูุงููุทุงุฑ",83:"ุงููุทูููู",84:"ุงูุงูุดูุงู",85:"ุงูุจุฑูุฌ",
  86:"ุงูุทุงุฑู",87:"ุงูุฃุนูู",88:"ุงูุบุงุดูุฉ",89:"ุงููุฌุฑ",90:"ุงูุจูุฏ",91:"ุงูุดูุณ",92:"ุงูููู",93:"ุงูุถุญู",
  94:"ุงูุดุฑุญ",95:"ุงูุชูู",96:"ุงูุนูู",97:"ุงููุฏุฑ",98:"ุงูุจููุฉ",99:"ุงูุฒูุฒูุฉ",100:"ุงูุนุงุฏูุงุช",101:"ุงููุงุฑุนุฉ",
  102:"ุงูุชูุงุซุฑ",103:"ุงูุนุตุฑ",104:"ุงูููุฒุฉ",105:"ุงูููู",106:"ูุฑูุด",107:"ุงููุงุนูู",108:"ุงูููุซุฑ",
  109:"ุงููุงูุฑูู",110:"ุงููุตุฑ",111:"ุงููุณุฏ",112:"ุงูุฅุฎูุงุต",113:"ุงูููู",114:"ุงููุงุณ"
};

const playlists = {
  "ุชุดุบูู ุทููู (ุณูุฑ ุทูููุฉ)": [
    { title: "ุงููุงุชุญุฉ", url: surahUrl(1) },
    { title: "ุงูุจูุฑุฉ", url: surahUrl(2) },
    { title: "ุขู ุนูุฑุงู", url: surahUrl(3) },
    { title: "ุงููุณุงุก", url: surahUrl(4) },
    { title: "ุงููุงุฆุฏุฉ", url: surahUrl(5) },
    { title: "ุงูุฃูุนุงู", url: surahUrl(6) },
    { title: "ุงูุฃุนุฑุงู", url: surahUrl(7) },
    { title: "ุงูุฃููุงู", url: surahUrl(8) },
    { title: "ุงูุชูุจุฉ", url: surahUrl(9) },
    { title: "ูููุณ", url: surahUrl(10) }
  ],
  "ุงูุฌุฒุก 30 (ุนูู) ูุงูู": Array.from({length: 37}, (_,i)=>78+i).map(n=>({title: juz30Names[n] || ("ุณูุฑุฉ " + n), url: surahUrl(n)})),
  "ุงูุฎุชูุฉ ุงููุงููุฉ (114 ุณูุฑุฉ)": Array.from({length:114},(_,i)=>i+1).map(n=>({title: "ุณูุฑุฉ " + n, url: surahUrl(n)}))
};

/* ===================== ุนูุงุตุฑ ุงููุงุฌูุฉ ===================== */
const playlistSelect = document.getElementById("playlistSelect");
const player = document.getElementById("player");
const nowPlaying = document.getElementById("nowPlaying");
const trackCount = document.getElementById("trackCount");
const playBtn = document.getElementById("playBtn");
const pauseBtn = document.getElementById("pauseBtn");
const nextBtn = document.getElementById("nextBtn");
const stopBtn = document.getElementById("stopBtn");
const playTime = document.getElementById("playTime");
const netState = document.getElementById("netState");
const toast = document.getElementById("toast");

const autoplayOverlay = document.getElementById("autoplay");
const autoplayStart = document.getElementById("autoplayStart");
const autoplayClose = document.getElementById("autoplayClose");

let currentListName = Object.keys(playlists)[0];
let currentIndex = 0;

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 2600);
}

function showAutoplayOverlay(){ autoplayOverlay.classList.add("show"); }
function hideAutoplayOverlay(){ autoplayOverlay.classList.remove("show"); }

function setNetLabel(){
  const online = navigator.onLine;
  netState.textContent = online ? "๐ ูุชุตู" : "๐ ุบูุฑ ูุชุตู";
}
window.addEventListener("online", setNetLabel);
window.addEventListener("offline", setNetLabel);
setNetLabel();

function fillPlaylists(){
  playlistSelect.innerHTML = "";
  Object.keys(playlists).forEach(name=>{
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    playlistSelect.appendChild(opt);
  });
  playlistSelect.value = currentListName;
  updateTrackCount();
  loadCurrent(false);
}

function updateTrackCount(){
  const list = playlists[currentListName];
  trackCount.textContent = `ุนุฏุฏ ุงูููุงุทุน: ${list.length}`;
}

function loadCurrent(save=true){
  const list = playlists[currentListName];
  const item = list[currentIndex];
  player.src = item.url;
  nowPlaying.textContent = `๐ง ุงูุขู: ${item.title} (${currentIndex+1}/${list.length})`;
  if(save){
    localStorage.setItem("plName", currentListName);
    localStorage.setItem("plIndex", String(currentIndex));
  }
}

async function safePlay(){
  try{
    await player.play();
    return true;
  }catch(e){
    return false;
  }
}

let userPaused = false;

function next(){
  const list = playlists[currentListName];
  currentIndex = (currentIndex + 1) % list.length;
  loadCurrent(true);
  safePlay().then(ok=>{ if(!ok) showAutoplayOverlay(); });
}

playlistSelect.addEventListener("change", ()=>{
  currentListName = playlistSelect.value;
  currentIndex = 0;
  userPaused = false;
  updateTrackCount();
  loadCurrent(true);
  safePlay().then(ok=>{ if(!ok) showAutoplayOverlay(); });
});

playBtn.addEventListener("click", async ()=>{
  userPaused = false;
  loadCurrent(true);
  const ok = await safePlay();
  if(!ok) showAutoplayOverlay();
});

pauseBtn.addEventListener("click", ()=>{
  userPaused = true;
  player.pause();
  showToast("ุชู ุงูุฅููุงู ุงููุคูุช");
});

stopBtn.addEventListener("click", ()=>{
  userPaused = true;
  player.pause();
  player.currentTime = 0;
  showToast("ุชู ุงูุฅููุงู");
});

nextBtn.addEventListener("click", ()=>{
  userPaused = false;
  next();
});

player.addEventListener("ended", ()=>{ if(!userPaused) next(); });

/* ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุนูุฏ ูุดุงูู ุงูุดุจูุฉ */
player.addEventListener("stalled", ()=>showToast("โณ ุฌุงุฑู ุงูุชุญูููโฆ"));
player.addEventListener("waiting", ()=>showToast("โณ ุฌุงุฑู ุงูุชุญูููโฆ"));

player.addEventListener("error", async ()=>{
  showToast("โ๏ธ ุชุนุฐูุฑ ุชุดุบูู ุงูููุทุน โ ูุญุงููุฉ ุงูุฅุตูุงุญโฆ");
  // ูุญุงููุฉ ุฅุนุงุฏุฉ ุชุญููู ููุณ ุงูููุทุน ูุฑุฉ ูุงุญุฏุฉ
  const same = player.src;
  try{
    player.src = same;
    const ok = await safePlay();
    if(!ok){
      setTimeout(()=>{ if(!userPaused) next(); }, 900);
    }
  }catch(e){
    setTimeout(()=>{ if(!userPaused) next(); }, 900);
  }
});

/* ุฅุฐุง ุชููู ูุฌุฃุฉ ุจุฏูู ุชุฏุฎู ุงููุณุชุฎุฏู: ูุญุงูู ุงูุงุณุชุฆูุงู */
player.addEventListener("pause", ()=>{
  if(userPaused) return;
  setTimeout(async ()=>{
    if(userPaused) return;
    const ok = await safePlay();
    if(!ok) showAutoplayOverlay();
  }, 700);
});

/* ุนูุฏ ุงูุฑุฌูุน ููุตูุญุฉ: ุญุงูู ุงูุงุณุชุฆูุงู */
document.addEventListener("visibilitychange", async ()=>{
  if(document.visibilityState === "visible" && !userPaused){
    const ok = await safePlay();
    if(!ok) showAutoplayOverlay();
  }
});
window.addEventListener("pageshow", async ()=>{
  if(!userPaused){
    const ok = await safePlay();
    if(!ok) showAutoplayOverlay();
  }
});

/* ุงูููุช */
setInterval(()=>{
  const t = Math.floor(player.currentTime || 0);
  const mm = String(Math.floor(t/60)).padStart(2,"0");
  const ss = String(t%60).padStart(2,"0");
  playTime.textContent = `โฑ ${mm}:${ss}`;
}, 500);

/* Autoplay overlay controls */
autoplayClose.addEventListener("click", hideAutoplayOverlay);
autoplayStart.addEventListener("click", async ()=>{
  hideAutoplayOverlay();
  userPaused = false;
  loadCurrent(true);
  const ok = await safePlay();
  if(!ok) showAutoplayOverlay();
});

/* ูุญุงููุฉ ุชุดุบูู ุชููุงุฆู ููุฑ ุงูุชุญููู */
window.addEventListener("load", async ()=>{
  const ok = await safePlay();
  if(!ok) showAutoplayOverlay();
});

/* ุนูุฏ ุฃูู ุชูุงุนู ูุญุงูู ุงูุชุดุบูู ูููุนูู Wake Lock */
let triedAuto = false;
async function tryAutoplayOnce(){
  if(triedAuto) return;
  triedAuto = true;
  if(!userPaused){
    const ok = await safePlay();
    if(!ok) showAutoplayOverlay();
  }
  enableWakeLock();
}
["click","touchstart","keydown"].forEach(evt=>{
  window.addEventListener(evt, ()=>tryAutoplayOnce(), {once:true, passive:true});
});

/* Wake Lock (ููุน ุงูุทูุงุก ุงูุดุงุดุฉ) */
let wakeLock = null;
async function enableWakeLock(){
  try{
    if("wakeLock" in navigator){
      wakeLock = await navigator.wakeLock.request("screen");
      showToast("โ ุชู ููุน ุงูุทูุงุก ุงูุดุงุดุฉ ุฃุซูุงุก ุงูุชุดุบูู");
      wakeLock.addEventListener("release", ()=>{});
    }
  }catch(e){
    // ุบูุฑ ูุฏุนูู ุฃู ูุฑููุถ
  }
}

/* ูุดุงุฑูุฉ ููุณุฎ ุฑุงุจุท */
async function copyText(txt){
  try{
    await navigator.clipboard.writeText(txt);
    showToast("ุชู ุงููุณุฎ โ");
  }catch(e){
    const ta = document.createElement("textarea");
    ta.value = txt;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    showToast("ุชู ุงููุณุฎ โ");
  }
}
document.getElementById("copyLinkBtn").addEventListener("click", ()=>copyText(location.href));

document.getElementById("shareBtn").addEventListener("click", async ()=>{
  const data = {
    title: document.title,
    text: "ุตุฏูุฉ ุฌุงุฑูุฉ ุนู ุงููุฑุญูู ููุฏ ุงููุฑุดู โ ุฃุฐูุงุฑ ูุชุดุบูู ุงููุฑุขู ุจุตูุช ุงูุณุฏูุณ ๐ค",
    url: location.href
  };
  if(navigator.share){
    try{ await navigator.share(data); }catch(e){}
  } else {
    await copyText(location.href);
    showToast("ุชู ูุณุฎ ุงูุฑุงุจุท (ุงููุดุงุฑูุฉ ุบูุฑ ูุฏุนููุฉ ููุง)");
  }
});

/* ููุก ุงูุดุงุดุฉ */
document.getElementById("fullBtn").addEventListener("click", async ()=>{
  try{
    if(!document.fullscreenElement){
      await document.documentElement.requestFullscreen();
      showToast("ุชู ุชูุนูู ููุก ุงูุดุงุดุฉ");
    }else{
      await document.exitFullscreen();
      showToast("ุชู ุงูุฎุฑูุฌ ูู ููุก ุงูุดุงุดุฉ");
    }
  }catch(e){
    showToast("ููุก ุงูุดุงุดุฉ ุบูุฑ ูุชุงุญ ุนูู ูุฐุง ุงูุฌูุงุฒ");
  }
});

/* ===================== ุงูุฃุฐูุงุฑ ===================== */
const adhkar = {
  morning: [
    { t: "ุฃุตุจุญูุง ูุฃุตุจุญ ุงูููู ูููุ ูุงูุญูุฏ ูููโฆ (ูุฑุฉ)", tag:"ุตุจุงุญ" },
    { t: "ุงูููู ุจู ุฃุตุจุญูุง ูุจู ุฃูุณููุง ูุจู ูุญูุง ูุจู ูููุช ูุฅููู ุงููุดูุฑ. (ูุฑุฉ)", tag:"ุตุจุงุญ" },
    { t: "ุฃุนูุฐ ุจูููุงุช ุงููู ุงูุชุงูุงุช ูู ุดุฑ ูุง ุฎูู. (3 ูุฑุงุช)", tag:"ุญูุธ" },
    { t: "ุงูููู ุฅูู ุฃุณุฃูู ุงูุนูู ูุงูุนุงููุฉ ูู ุงูุฏููุง ูุงูุขุฎุฑุฉ. (ูุฑุฉ)", tag:"ุฏุนุงุก" },
    { t: "ุณูุจูุญูุงูู ุงูููู ูุจุญูุฏููู. (100 ูุฑุฉ) ุฃู ูุง ุชูุณุฑ", tag:"ุชุณุจูุญ" }
  ],
  evening: [
    { t: "ุฃูุณููุง ูุฃูุณู ุงูููู ูููุ ูุงูุญูุฏ ูููโฆ (ูุฑุฉ)", tag:"ูุณุงุก" },
    { t: "ุงูููู ุจู ุฃูุณููุง ูุจู ุฃุตุจุญูุง ูุจู ูุญูุง ูุจู ูููุช ูุฅููู ุงููุตูุฑ. (ูุฑุฉ)", tag:"ูุณุงุก" },
    { t: "ุฃุนูุฐ ุจูููุงุช ุงููู ุงูุชุงูุงุช ูู ุดุฑ ูุง ุฎูู. (3 ูุฑุงุช)", tag:"ุญูุธ" },
    { t: "ุงูููู ุฅูู ุฃุณุฃูู ุงูุนูู ูุงูุนุงููุฉ ูู ุงูุฏููุง ูุงูุขุฎุฑุฉ. (ูุฑุฉ)", tag:"ุฏุนุงุก" },
    { t: "ุณูุจูุญูุงูู ุงูููู ูุจุญูุฏููู. (100 ูุฑุฉ) ุฃู ูุง ุชูุณุฑ", tag:"ุชุณุจูุญ" }
  ],
  sleep: [
    { t: "ุจุงุณูู ุฑุจู ูุถุนุช ุฌูุจู ูุจู ุฃุฑูุนูโฆ (ูุฑุฉ)", tag:"ููู" },
    { t: "ุงูููู ูููู ุนุฐุงุจู ููู ุชุจุนุซ ุนุจุงุฏู. (3 ูุฑุงุช)", tag:"ููู" },
    { t: "ูุฑุงุกุฉ ุขูุฉ ุงููุฑุณู ูุจู ุงูููู.", tag:"ุญูุธ" },
    { t: "ุณุจุญุงู ุงููู (33) ุงูุญูุฏ ููู (33) ุงููู ุฃูุจุฑ (34).", tag:"ุชุณุจูุญ" }
  ]
};

const area = document.getElementById("adhkarArea");
function renderAdhkar(kind){
  const list = adhkar[kind];
  area.innerHTML = "";
  list.forEach(item=>{
    const box = document.createElement("div");
    box.className = "dhikr";
    box.innerHTML = `<div class="t">${item.t}</div><div class="pill">${item.tag}</div>`;
    area.appendChild(box);
  });
  localStorage.setItem("adhkarKind", kind);
}
document.getElementById("showMorning").addEventListener("click", ()=>renderAdhkar("morning"));
document.getElementById("showEvening").addEventListener("click", ()=>renderAdhkar("evening"));
document.getElementById("showSleep").addEventListener("click", ()=>renderAdhkar("sleep"));
document.getElementById("randomDhikr").addEventListener("click", ()=>{
  const kinds = Object.keys(adhkar);
  const kind = kinds[Math.floor(Math.random()*kinds.length)];
  const list = adhkar[kind];
  const item = list[Math.floor(Math.random()*list.length)];
  showToast("โจ " + item.t);
});

/* ===================== ุนุฏูุงุฏ ุงูุชุณุจูุญ ===================== */
let count = Number(localStorage.getItem("tasbihCount") || "0");
const countEl = document.getElementById("count");
countEl.textContent = count;
let history = [];
function setCount(n){
  count = Math.max(0, n);
  countEl.textContent = count;
  localStorage.setItem("tasbihCount", String(count));
}
function inc(){
  history.push(count);
  if(history.length>60) history.shift();
  setCount(count + 1);
}
document.getElementById("tasbihBtn").addEventListener("click", inc);
document.getElementById("tahmidBtn").addEventListener("click", inc);
document.getElementById("takbirBtn").addEventListener("click", inc);
document.getElementById("tahlilBtn").addEventListener("click", inc);
document.getElementById("resetBtn").addEventListener("click", ()=>{
  history.push(count);
  setCount(0);
  showToast("ุชู ุชุตููุฑ ุงูุนุฏุงุฏ");
});
document.getElementById("undoBtn").addEventListener("click", ()=>{
  if(history.length){
    setCount(history.pop());
    showToast("ุชู ุงูุชุฑุงุฌุน");
  }else{
    showToast("ูุง ููุฌุฏ ุดูุก ููุชุฑุงุฌุน");
  }
});

/* ===================== ุงุณุชุนุงุฏุฉ ุงูุญุงูุฉ ุงูุณุงุจูุฉ ===================== */
(function restore(){
  const savedName = localStorage.getItem("plName");
  const savedIndex = Number(localStorage.getItem("plIndex") || "0");
  const savedAdhkar = localStorage.getItem("adhkarKind") || "morning";
  if(savedName && playlists[savedName]) currentListName = savedName;
  currentIndex = (Number.isFinite(savedIndex) ? Math.max(0, savedIndex) : 0);
  fillPlaylists();
  renderAdhkar(savedAdhkar);
  loadCurrent(false);
})();

/* ===================== PWA (ุงุฎุชูุงุฑู) ===================== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("./sw.js").catch(()=>{});
}
</script>
</body>
</html>
